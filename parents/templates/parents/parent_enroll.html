{% comment %} {% extends "wizard_base.html" %} {% endcomment %}

{% load static %}

{% block css_file %}
    <link rel="stylesheet" href="{% static "parents/parent.css" %}" >
    <link rel="stylesheet" href="{% static 'parents/button.css' %}">
    <link rel="stylesheet" href="{% static 'parents/common.css' %}">
{% endblock %}

{% block content %}
{% include "includes/messages.html" %}

<div class="progress-container">
    <div
        class="progress-bar"
        role="progressbar"
        style="width: {{ progress_percent }}%;"
        aria-valuenow="{{ current_step }}"
        aria-valuemin="0"
        aria-valuemax="{{ total_steps }}"
    ></div>
</div>
<h3 id="hh4">Step {{ current_step }} of {{ total_steps }}</h3>

<h2 id="hh2">Step 1: Parent Information</h2>

<!-- Welcome & Instructions -->
<div class="intro-box">
    <h2> Dear Parent, Welcome to Parent Registration Page!</h2>

    <div class="forms-actions">
          <button type="submit" name="add_another">Your effort today will shine in your child’s tomorrow. Inshaallah!</button>
          <button type="submit">Thank you for being here. Let's Get Started</button>
    </div>
    <h4 id="hhh4">
      This step allows you to register parent information for the student.
    </h4>
    <ul>
      <li>👉 If the parent is <strong>already registered</strong>, Choose<strong><em> Select From Existing Parents</strong></em> and select them from the list.</li>
      <li>👉 If the parent is <strong>new</strong>, choose <strong><em>Add New Parent</em></strong> and fill in the form.</li>
    </ul>
</div> 

<!-- Choice cards -->
<div class="choice-container">
    <label class="choice-card">
        <input type="radio" name="parent_choice" value="existing">
        Select From Existing Parents
    </label>

    <label class="choice-card">
        <input type="radio" name="parent_choice" value="new">
        Add New Parents
    </label>
 </div> 

<!-- Existing Parents Section  (hidden by default)  -->
 <div id="existing-parents-section" style="display:none; margin-top: 1rem;">
    <form method="post">
        {% csrf_token %}
        
         <h3>Choose parents from already in the system:</h3>
         <p><small>➡️ If you use <strong>Windows</strong>: Hold <kbd>CTRL</kbd> and click to select multiple parents.</small></p>
         <p><small>➡️ If you use <strong>Mac</strong>: Hold <kbd>CMD</kbd> and click to select multiple parents.</small></p>
         <p><small>➡️ If you use a <strong>phone/tablet</strong>: Just tap each parent you want to select multiple parents.</small></p>
         <p><small> In Any Case, Also possible to use <strong>Save & Add Another</strong> Button, to select more.</small></p>

        <input type="hidden" name="form_type" value="existing">
        <select name="existing_parents" multiple size="5">
          {% for parent in all_parents %}
          <div id="p-list">
          <option value="{{ parent.id }}" >
              {{parent.id}}  {{ parent.first_name }} {{ parent.middle_name }} {{ parent.last_name }}
          </option>
          </div>
          {% empty %}
          <option disabled>No parents found</option>
          {% endfor %}
       </select>

        <!-- Form actions -->
      <div class="form-actions">
        <a href="{% url 'dashboard' %}" class="back-btn">Back</a>
          <button type="submit" name="add_another">💾 Save & Add Another</button>
          <button type="submit">➡️  Next</button>
      </div>
    </form>
</div>

<!-- New Parent Section (hidden by default) -->
<div id="new-parent-section" style="display:none;">
  <form method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="con">
        <h3>Add New Parent</h3>
          <h4>Fill out details for a new parent who is not yet registered.</h4>
          <h4 id="hh4">👉 You can add multiple parents. Use <strong>Save & Add Another</strong> to register more.</h4>
          <input type="hidden" name="form_type" value="new">
         <div class="form_control">
            {{ form.as_p }} 
          </div>
      </div> 

      <!-- Form actions -->
      <div class="form-actions">
        <a href="{% url 'dashboard' %}" class="back-btn">Back</a>
          <button type="submit" name="add_another">💾 Save & Add Another</button>
          <button type="submit">➡️  Next</button>
      </div>
  </form> 
</div>

    <!-- JS Toggle -->
    <script>
        // Toggle between sections
        document.addEventListener("DOMContentLoaded", function () {
            const existingSection = document.getElementById("existing-parents-section");
            const newSection = document.getElementById("new-parent-section");
            const radios = document.querySelectorAll("input[name='parent_choice']");

            let lastChecked = null;  // track the last clicked radio

            function toggleSections() {
            const choice = document.querySelector("input[name='parent_choice']:checked");
            
            if (!choice) {
            existingSection.style.display = "none";
            newSection.style.display = "none";
            return;
            }

            if (choice.value === "existing") {
            existingSection.style.display = "block";
            newSection.style.display = "none";
            } else {
            existingSection.style.display = "none";
            newSection.style.display = "block";
            }
        }
            radios.forEach(radio => {
                radio.addEventListener("click", function (e) {
                    if (lastChecked === this) {
                        this.checked = false;
                        lastChecked = null;
                        existingSection.style.display = "none";
                        newSection.style.display = "none";
                    } else {
                        lastChecked = this;
                    }
                    toggleSections();
                });
            });

            // Run once on load
            toggleSections();
        });
   </script>

   <footer>
    <h1>Cleanliness is valuable!</h1>
    <h1>ንፅህና ዋጋ አለው!</h1>
    <h1>Safuun gatii qaba!</h1>
  </footer>

{% endblock %}