{% comment %} {% extends "wizard_base.html" %} {% endcomment %}

{% load static %}

{% block css_file %}
    <link rel="stylesheet" href="{% static "parents/parent.css" %}" >
{% endblock %}

{% block content %}
{% include "includes/messages.html" %}

<div class="progress-container">
    <div
        class="progress-bar"
        role="progressbar"
        style="width: {{ progress_percent }}%;"
        aria-valuenow="{{ current_step }}"
        aria-valuemin="0"
        aria-valuemax="{{ total_steps }}"
    ></div>
</div>
<p>Step {{ current_step }} of {{ total_steps }}</p>

<h2>Step 1: Parent Information</h2>

<!-- Welcome & Instructions -->
{% comment %} <div class="intro-box">
  <h2> Dear Customer, Welcome to Parent Registration Page!</h2>
  <h4>
    This step allows you to register parent information for the student.
  </h4>
  <ul>
    <li>üëâ If the parent is <strong>already registered</strong>,<strong><em> Choose Select From Existing Parents</strong></em> and select them from the list.</li>
    <li>üëâ If the parent is <strong>new</strong>, <strong><em>choose Add New Parent</em></strong> and fill in the form.</li>
    {% comment %} <li>üëâ You can add multiple parents. Use <strong>Save & Add Another</strong> to register more.</li> on form {% endcomment %} 
  {% comment %} </ul> {% endcomment %}
{% comment %} </div> {% endcomment %}

<!-- Choice cards -->
    {% comment %} <div class="choice-container">
            <label class="choice-card">
                <input type="radio" name="parent_choice" value="existing">
                Select From Existing Parents
            </label>

            <label class="choice-card">
                <input type="radio" name="parent_choice" value="new">
                Add New Parents
            </label>
    </div> {% endcomment %}

<!-- Main form -->
{% comment %} <form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    
    <!-- New Parent Section (hidden by default) -->
    <div id="new-parent-section" style="display:none;">
        <h3>Add New Parent</h3>
        <p>Fill out details for a new parent who is not yet registered.</p>
        {{ form.as_p }}
    </div>

    <!-- JS Toggle -->
    <script>
        // Toggle between sections
        document.addEventListener("DOMContentLoaded", function () {
            const existingSection = document.getElementById("existing-parents-section");
            const newSection = document.getElementById("new-parent-section");
            const radios = document.querySelectorAll("input[name='parent_choice']");

           // function toggleSections() {
                //if (document.querySelector("input[name='parent_choice']:checked").value === "existing") {
                   // existingSection.style.display = "block";
              //  } else {
                 //   existingSection.style.display = "none";
                  //  newSection.style.display = "block";
               // }
            //}

            let lastChecked = null;  // track the last clicked radio

            function toggleSections() {
            const choice = document.querySelector("input[name='parent_choice']:checked");
            
            if (!choice) {
            existingSection.style.display = "none";
            newSection.style.display = "none";
            return;
            }

            if (choice.value === "existing") {
            existingSection.style.display = "block";
            newSection.style.display = "none";
            } else {
            existingSection.style.display = "none";
            newSection.style.display = "block";
            }
        }

            radios.forEach(radio => {
                // radio.addEventListener("change", toggleSections);
                radio.addEventListener("click", function (e) {
                    if (lastChecked === this) {
                        this.checked = false;
                        lastChecked = null;
                        existingSection.style.display = "none";
                        newSection.style.display = "none";
                    } else {
                        lastChecked = this;
                    }
                    toggleSections();
                });
            });

            // Run once on load
            toggleSections();
        });
   </script>
</form>

<!-- Main form -->
<form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <!-- Existing Parents Section -->
        <div id="existing-parents-section" >
            <h3>Select Existing Parents</h3>
            <h4>Choose from parents already in the system.</h4>
            <select name="existing_parents[]" multiple size="5">
                {% for parent in all_parents %}
                <option value="{{parent.id}}"
                {% if parent in selected_parents %}selected{% endif %}>
                    {{parent.id}}  {{ parent.first_name }} {{ parent.middle_name }} {{ parent.last_name }}
                </option>
                {% empty %}
                <option disabled>No parents found</option>
                {% endfor %}
            </select>
        </div>
        <!-- Form actions -->
    <div class="form-actions">
        <button type="submit" name="add_another">üíæ Save & Add Another</button>
        <button type="submit">‚û°Ô∏è  Next</button>
    </div>
</form> {% endcomment %}

<h2>Parent Information</h2>

<!-- Radio buttons for choice -->
<label>
  <input type="radio" name="parent_choice" value="existing"> Select Existing Parent
</label>
<label>
  <input type="radio" name="parent_choice" value="new"> Add New Parent
</label>

<!-- Existing parent form -->
<div id="existing-parents-section" style="display:none; margin-top: 1rem;">
  <form method="POST" action="{% url 'prnt_info' %}">
    {% csrf_token %}
    <input type="hidden" name="form_type" value="existing">

    <label for="existing_parents">Choose parents:</label>
    <select name="existing_parents" multiple>
      {% for parent in all_parents %}
        <option value="{{ parent.id }}">{{ parent.first_name }} {{ parent.last_name }}</option>
      {% endfor %}
    </select>

    <button type="submit">Use Existing</button>
  </form>
</div>

<!-- New parent form -->
<div id="new-parent-section" style="display:none; margin-top: 1rem;">
  <form method="POST" action="{% url 'prnt_info' %}">
    {% csrf_token %}
    <input type="hidden" name="form_type" value="new">

    {{ form.as_p }}

    <button type="submit">Add New Parent</button>
  </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const existingSection = document.getElementById("existing-parents-section");
  const newSection = document.getElementById("new-parent-section");
  const radios = document.querySelectorAll("input[name='parent_choice']");

  function toggleSections() {
    const choice = document.querySelector("input[name='parent_choice']:checked");
    if (!choice) {
      existingSection.style.display = "none";
      newSection.style.display = "none";
      return;
    }
    if (choice.value === "existing") {
      existingSection.style.display = "block";
      newSection.style.display = "none";
    } else {
      existingSection.style.display = "none";
      newSection.style.display = "block";
    }
  }

  radios.forEach(radio => radio.addEventListener("change", toggleSections));
});
</script>


{% endblock %}