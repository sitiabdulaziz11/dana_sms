{% comment %} {% extends "wizard_base.html" %} {% endcomment %}

{% load static %}

{%block title %}
   
{% endblock title %}
    
{% block css_file %}
    <link rel="stylesheet" href="{% static "parents/parent.css" %}" >
    <link rel="stylesheet" href="{% static 'parents/common.css' %}">
{% endblock %}

{% block content %}

{% include "includes/messages.html" %}

    <div class="progress-container">
    <div
        class="progress-bar"
        role="progressbar"
        style="width: {{ progress_percent }}%;"
        aria-valuenow="{{ current_step }}"
        aria-valuemin="0"
        aria-valuemax="{{ total_steps }}"
    ></div>
</div>
<h3 id="hh2">Step {{ current_step }} of {{ total_steps }}</h3>

    <h2 id="hhh2pay">Make Payment for {{ student.first_name}} {{ student.middle_name}}</h2>
    <form id="paymentForm" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="form_control">
            {{ form.as_p}}
        </div>

        <button type="submit">Make Monthly Payment</button>

        <div class="form-actions">
            <a href="{% url 'dashboard' %}" class="back-btn">Back</a>
            <button type="submit" name="add_another">Save & Add Another</button>
            <button type="submit">Review</button>
            {% comment %} <a href="{% url 'edit' %}" class="review-btn">Review</a> {% endcomment %}
        </div>
    </form>

    <footer>
    <h2>Cleanliness is valuable!</h2>
    <h2>·äï·çÖ·àÖ·äì ·ãã·åã ·ä†·àà·ãç!</h2>
    <h2>Safuun gatii qaba!</h2>
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
        const form = document.getElementById("paymentForm");

        form.addEventListener("submit", function(event) {
        // Prevent immediate submission
        event.preventDefault();

        // Get values from form fields
        const studentSelect = document.querySelector("select[name='student']");
        const monthSelect = document.querySelector("select[name='debited_month']");
        const paymentType = document.querySelector("select[name='payment_type']");
        const amount = document.querySelector("input[name='amount']");

        // Get readable values
        const studentName = studentSelect ? studentSelect.options[studentSelect.selectedIndex].text : "Unknown";
        const month = monthSelect ? monthSelect.options[monthSelect.selectedIndex].text : "Unknown";
        const type = paymentType ? paymentType.options[paymentType.selectedIndex].text : "Unknown";
        const amt = amount ? amount.value : "0";

        // Build confirmation message
        const message = `‚ö†Ô∏è Are you sure you want to record this payment?\n\n` +
                        `üë§ Student: ${studentName}\n` +
                        `üíµ Amount: ${amt}\n` +
                        `üóìÔ∏è Month: ${month}\n` +
                        `üìò Type: ${type}`;

        // Show confirmation popup
        if (confirm(message)) {
            // If user confirms, proceed to submit form
            form.submit();
        } else {
            // Else, cancel
            alert("Payment cancelled. Please review and try again.");
        }
    });
    });

  </script>

{% endblock %}
